# WoST use of the TD - under development

The objective is to be fully compliant with the official specification.
The latest known draft at the time of writing is [Nov 2020](https://www.w3.org/TR/2020/WD-wot-thing-description11-20201124/#sec-core-vocabulary-definition)

Interpreting this specification is not always easy so slight differences might exist. Below a list of issues encountered and the WoST interpretation on them:

## version
Spec: The spec defines version as type VersionInfo or Array of VersionInfo.

Issue: The [spec definition of VersionInfo](https://www.w3.org/TR/2020/WD-wot-thing-description11-20201124/#versioninfo) is unclear. It is not clear what Vocuabulary term 'instance' means. It is interpreted that this can be a string.

Recommendation: 
- Clarify the definition of VersionInfo, for example string or struct.

## Created/Modified Dates
Spec: type is of [datetime](https://www.w3.org/TR/2012/REC-xmlschema11-2-20120405/#dateTime)
WoST: Date follows [ISO8601](https://en.wikipedia.org/wiki/ISO_8601) and creates dates in the format YYYY-MM-DDTHH:MM:SS.sss-TZ, where TZ is the -0000 offset or 'Z' for UTC.

The description of the TD datetime spec is hard to interpret. After reading it a few times I gave up and just stuck to the internationally accepted ISO8601 with timezone for datetimes generated by WoST. It looks the same as what the TD describes. I recommend that the TD spec includes a sample or describes its relationship wrt ISO8601.

A datetime format passed to WoST will be retained unchanged.

## Links

Things can not have Links in WoST as they conflict with the paradigm that "Things are not servers". However, a Hub/Intermediary can add links that point to the Hub.


## Forms

The WoT specification for a [Form](https://www.w3.org/TR/2020/WD-wot-thing-description11-20201124/#form) says: A form can be viewed as a statement of "To perform an operation type operation on form context, make a request method request to submission target" where the optional form fields may further describe the required request. 

In the TD specification, Forms define how to connect to the Thing. In WOST, this connection takes place via the Hub that represents the Thing.


### SecuritySchema 'scheme' (1)
Spec: any type, one of ...
WoST: The combo scheme is not supported

Rational: combo is too vague and complicated to know how to implement and test it. The problem it solves seems rather theoretical. Lightweight Things are unlikely to implement this complexity. Higher powered Things are more likely to implement additional regular security schemes, making it unnecesary. Also a concern is that ambiguity in security schemes increase the risk of vulnerabilities. 

Recommendation: Remove it in favor of more explicit schema if needed. If an 'allof' combo is really needed then define this combo as a separate schema. 


### SecuritySchema 'scheme' (2)
Spec: Identification of the security mechanism being configured.
WoST: ??? not sure what to do here

Issue is that this looks like a string but could be one of multiple structs.
- If this field is a string identifier of the scheme, then where to define the scheme fields?
- If this field is a scheme struct then how to identify what scheme it is? The security scheme definitions do not hold an identifier.
- How to parse this in a strongly typed language


# WoST REST API

WoST compliant Things do not implement servers. All interaction takes place via the WoST secured hub which acts as an intermediary. Other than that the REST API that consumers use to access Web Things follows the description in [http-api.md](https://github.com/wostzone/hubapi-go/docs/http-api.md) which is based on Mozilla's Web Thing REST API](https://iot.mozilla.org/wot/#web-thing-rest-api).

The address of the Thing is that of the hub as follows:

```http
GET https://hub/things/{thingID}[/...]
```

Note1: the Mozilla specification often assumes or suggests that Things are directly accessed, which is not allowed in WoST. Therefore the implementation of this API in WoST MUST follow the following rules:
1. The Thing address is that of the hub it is connected to.
2. The full thing ID must be included in the API. The examples says 'lamp' where a Thing ID is a URN: "urn:zone:publisher:name" for example.
3. The hub will update action href fields to point to the hub. 

Note2: The Mozilla API does not support queries.

Note3:the hubapi-go package provides a client implementation using MQTT. This is the most efficient way to communicate with the Hub. A http protocol binding for 3rd party clients is planned for the Hub.

# WoST WebSocket API

Similar to the REST API, WebSocket based access follows Mozilla's specification. 

Note that again the consumer connects to the hub, not the Thing. The connection address contains the Thing ID as follows:

```http
GET wss://hub/things/{thingID}
```

Where thingID is the full URI of the thing as defined in [Thing id](https://www.w3.org/TR/2020/WD-wot-thing-description11-20201124/#thing)

Note:the hubapi-go package provides a client implementation using MQTT. This is the most efficient way to communicate with the Hub.  A http protocol binding for 3rd party clients is planned for the Hub.


# Thing IDs

Note: In WoST the ID of a Thing can be modified by the hub if the TD is received from an intermediary to reflect the domain of the Thing. 

For example, a thing with ID "URN:publisher1:thing1" is made available by hub with domain 'home1' to intermediary with domain 'bob.com'. When bob exposes the Thing, its ID is shown as "URN:home1:publisher1:thing1".

This will avoid naming collision on bob.com by other hubs that have Things with the same ID. Similarly any references to the original hub are replaced with bob.com's address.

The Mozilla API does not support queries.

## Vocabulary Of TD Property Types 

Thing properties can be used to describe sensors, actuators, internal attributes, internal state, and internal configuration. The WoT TD specification does not include
these Thing property types in its vocabulary. Therefore they are defined as WoST vocabulary with the prefix "wost:". Note this should really not be neccesary.

The '@type' attribute is used to identify the type of property (different from the data type), as suggested by @sebastiankb in this discussion: https://github.com/w3c/wot-thing-description/issues/1079. Property types are defined in hubapi api/vocabulary.go, eg: "sensor", "actuator", "configuration", "state", "attr", "input", "output" where configuration is the only writable attribute, state reflects the internal device state and can change in runtime, and attr is an static descriptive attribute such as vendor, version, and such.

Property names are part of the IoT schema. Without a recommended or commonly accepted schema, WoST uses vocabulary from existing schema definitions such as schema.org and iotschema.org.
