# WoST use of the TD - under development

The objective is to be fully compliant with the official specification.
The latest known draft at the time of writing is [Nov 2020](https://www.w3.org/TR/2020/WD-wot-thing-description11-20201124/#sec-core-vocabulary-definition)

Interpreting this specification is not always easy so slight differences might exist. Below a list of issues encountered and the WoST interpretation on them:

## version
Spec: The spec defines version as type VersionInfo or Array of VersionInfo.
WoST: Wost accepts a string following semantic versioning, eg [Major.Minor.Patch format](https://semver.org/).

1. Only a single string is accepted because in typed languages a field must be of a single type. You cannot represent a value as a single type or array of that type at the same time.
2. The [spec definition of VersionInfo](https://www.w3.org/TR/2020/WD-wot-thing-description11-20201124/#versioninfo) is unclear. It is not clear what Vocuabulary term 'instance' means. It is interpreted that this can be a string.

Recommendations: 
1. Add a 'versions' field for a map of VersionInfo by type of version (application, hardware, firmware).
2. Clarify the definition of VersionInfo, for example string or struct.

## Created/Modified Dates
Spec: type is of [datetime](https://www.w3.org/TR/2012/REC-xmlschema11-2-20120405/#dateTime)
WoST: Date follows [ISO8601](https://en.wikipedia.org/wiki/ISO_8601) and creates dates in the format YYYY-MM-DDTHH:MM:SS.sss-TZ, where TZ is the -0000 offset or 'Z' for UTC.

The description of the TD datetime spec is hard to interpret. After reading it a few times I gave up and just stuck to the internationally accepted ISO8601 with timezone for datetimes generated by WoST. It looks the same as what the TD describes. I recommend that the TD spec includes a sample or describes its relationship wrt ISO8601.

A datetime format passed to WoST will be retained unchanged.

## Support
Spec: support is of type any type
WoST: support is a string containing a URI 

Rational: Strongly type languages expect a single type when parsing JSON. Since the intent seems to be to hold a URI a string is supported; quote: "Provides information about the TD maintainer as URI scheme".

Recommendation: Define the type as string, not as 'any'.

## Properties

## Actions

## Events

## Links
Only supported for WoST Things that provide access through the hub. Links that access a Thing directly are not supported.

Rational: The WoST paradigm "Things are not servers" does not allow Things to act as a server. Hence any link to the Thing would be invalid.

If a WoST Thing includes a link that references the hub API to access information from the Thing, then this can be supported. 


## Forms
Not supported in WoST at this time.

The WoT specification for a [Form](https://www.w3.org/TR/2020/WD-wot-thing-description11-20201124/#form) says: A form can be viewed as a statement of "To perform an operation type operation on form context, make a request method request to submission target" where the optional form fields may further describe the required request. 

Support is considered once this is better understood and if it can be done through the hub.

Rational: The WoST paradigm "Things are not servers" does not allow Things to act as a server and thus it cannot be controlled directly through a Form. Instead, the control must go through the hub. 

If a WoST Thing publishes a form that uses the hub API to control the thing then this could be supported in the future.


## Security
Spec: security is defined as a SecuritySchema or Array of SecuritySchema
WoST: security is defined as an array of SecuritySchema

Rational: In a strongly type lanugage a field can only be of a single type. Since multiple security schemas are common, WoST only accepts an array.

### SecuritySchema '@type'
Spec: @type is defined as string or array of string
WoST: @type is defined as a string

Rational: In a strongly type lanugage a field can only be of a single type. Since most examples use a single type, only a single type is supported.

### SecuritySchema 'scheme' (1)
Spec: any type, one of ...
WoST: The combo scheme is not supported

Rational: combo is too vague and complicated to know how to implement and test it. The problem it solves seems rather theoretical. Lightweight Things are unlikely to implement this complexity. Higher powered Things are more likely to implement additional regular security schemes, making it unnecesary. Also a concern is that ambiguity in security schemes increase the risk of vulnerabilities. 

Recommendation: Remove it in favor of more explicit schema if needed. If an 'allof' combo is really needed then define this combo as a separate schema. 


### SecuritySchema 'scheme' (2)
Spec: Identification of the security mechanism being configured.
WoST: ??? not sure what to do here

Issue is that this looks like a string but could be one of multiple structs.
- If this field is a string identifier of the scheme, then where to define the scheme fields?
- If this field is a scheme struct then how to identify what scheme it is? The security scheme definitions do not hold an identifier.
- How to parse this in a strongly typed language


# WoST REST API

WoST compliant Things do not implement servers. All interaction takes place via the WoST secured hub which acts as an intermediary. Other than that the REST API that consumers use to access Web Things follows the description in [Mozilla's Web Thing REST API](https://iot.mozilla.org/wot/#web-thing-rest-api).

The address of the Thing is that of the hub as follows:

```http
GET https://hub/things/{thingID}[/...]
```

Note that this specification often assumes or suggests that Things are directly accessed, which is not allowed in WoST. Therefore the implementation of this API in WoST MUST follow the following rules:
1. The Thing address is that of the hub it is connected to.
2. The full thing ID must be included in the API. The examples says 'lamp' where a Thing ID is a URN: "urn:zone:publisher:name" for example.
3. The hub will update action href fields to point to the hub. 

The Mozilla API does not support queries.

# WoST WebSocket API

Similar to the REST API, WebSocket based access follows Mozilla's specification. 

Note that again the consumer connects to the hub, not the Thing. The connection address contains the Thing ID as follows:

```http
GET wss://hub/things/{thingID}
```

Where thingID is the full URI of the thing as defined in [Thing id](https://www.w3.org/TR/2020/WD-wot-thing-description11-20201124/#thing)

# Thing IDs

Note: In WoST the ID of a Thing can be modified by the hub if the TD is received from an intermediary to reflect the domain of the Thing. 

For example, a thing with ID "URN:publisher1:thing1" is made available by hub with domain 'home1' to intermediary with domain 'bob.com'. When bob exposes the Thing, its ID is shown as "URN:home1:publisher1:thing1".

This will avoid naming collision on bob.com by other hubs that have Things with the same ID. Similarly any references to the original hub are replaced with bob.com's address.

The Mozilla API does not support queries.

