# WoST use of the TD - under development

WoST intends to be compliant with the WoT Thing Description specification.
The latest known draft at the time of writing is [Mar 2022](https://www.w3.org/TR/wot-thing-description11/#thing)

Interpreting this specification is done as a best effort. In case where discrepancies are reported they will be corrected when possible as long as they do not conflict with the WoST core paradigm of 'Things do not run servers'.

Below a collection of notes where differences or constraints might exist in WoST with a clarification on how WoST handles the particular issue.  

# WoST Device Model

The WoST device model is more specific than the WoT TD document. Where the WoT TD is quite generic and open to many forms of implementation, the WoST model provides practical description of IoT devices and services and limits its use to the core paradigm of 'things do not run services'.


This section describes the WoST Device Model and its mapping to WoT TD document.

In WoST Things are described as having:
* attributes - readonly values that describe the state of the thing
* configuration - configuration of the behavior of the thing 
* inputs - to operate things
* outputs - provide the result of the thing's function, For example, sensors have a sensor value as an output

This device model is mapped to the WoT TD document 




## version
Spec: The spec defines version as type VersionInfo or Array of VersionInfo.

Issue: The [spec definition of VersionInfo](https://www.w3.org/TR/2020/WD-wot-thing-description11-20201124/#versioninfo) is unclear. It is not clear what Vocuabulary term 'instance' means. It is interpreted that this can be a string.

Recommendation: 
- Clarify the definition of VersionInfo, for example string or struct.

## Created/Modified Dates
Spec: type is of [datetime](https://www.w3.org/TR/2012/REC-xmlschema11-2-20120405/#dateTime)
WoST: Date follows [ISO8601](https://en.wikipedia.org/wiki/ISO_8601) and creates dates in the format YYYY-MM-DDTHH:MM:SS.sss-TZ, where TZ is the -0000 offset or 'Z' for UTC.

The description of the TD datetime spec is hard to interpret. After reading it a few times I gave up and just stuck to the internationally accepted ISO8601 with timezone for datetimes generated by WoST. Since this seems to match the TD examples from the spec it is assumed to be compliant.

## Links

The spec describes a [link](https://www.w3.org/TR/wot-thing-description11/#link) as "A link can be viewed as a statement of the form "link context has a relation type resource at link target", where the optional target attributes may further describe the resource"

In WoST a link can be used as long as it is not served by the IoT device, as this would conflict with the paradigm that "Things are not servers". 


## Forms

The WoT specification for a [Form](https://www.w3.org/TR/wot-thing-description11/#form) says: A form can be viewed as a statement of "To perform an operation type operation on form context, make a request method request to submission target" where the optional form fields may further describe the required request. 

The provided example shows an HTTP POST to write a property. 

In WoST an important constraint is that form operations that define HTTP operations on the Thing device are prohibited. Things don't run servers and can therefore not respond to HTTP commands.
What is possible is a form describing a MQTT topic on the Hub message bus, on which the device publishes or subscribes. 
Also allowed are forms that describe additional help information that is provided via an external http server.


### SecuritySchema 'scheme' (1)

In WoST all authentication and authorization is handled by the Hub. Therefore, the security scheme section only applies to Hub services and does not apply to WoST Things.




### SecuritySchema 'scheme' (2)
Spec: any type, one of ...
WoST: The [combo scheme](https://www.w3.org/TR/wot-thing-description11/#combosecurityscheme) is not supported

Rational: combo is too vague and complicated to know how to implement and test it. The problem it solves seems rather theoretical. Lightweight Things are unlikely to implement this complexity. Higher powered Things are more likely to implement additional regular security schemes, making it unnecesary. Also a concern is that ambiguity in security schemes increase the risk of vulnerabilities. 

Recommendation: Remove it in favor of more explicit schema if needed. If an 'allof' combo is really needed then define this combo as a separate schema. 



# WoST REST API

WoST compliant Things do not implement servers. All interaction takes place via WoST Hub services and message bus. 

WoST services can provide a web API. For example, the Directory Service and Provisioning Service provide web API's.

Hub services that implement a REST API follows the approach as described in Mozilla's Web Thing REST API](https://iot.mozilla.org/wot/#web-thing-rest-api). 

```http
GET https://address:port/things/{thingID}[/...]
```

Note1: the Mozilla specification often assumes or suggests that Things are directly accessed, which is not allowed in WoST. Therefore the implementation of this API in WoST MUST follow the following rules:
1. The Thing address is that of the hub it is connected to.
2. The full thing ID must be included in the API. The examples says 'lamp' where a Thing ID is a URN: "urn:zone:publisher:lamp" for example.
3. Things cannot include action href fields in their TD, only MQTT urls. 

Note2: The Mozilla API does not support queries.

Note3:the WoST hub lib/client package provides a client implementation using MQTT. This is the most efficient way to communicate with the Hub. A https protocol binding that delegates to the MQTT message bus can be added in the future.

# WoST WebSocket API

Similar to the REST API, WebSocket based access follows Mozilla's specification.

In addition, the websocket API allows listening for events as per protocol definition. (tbd) 


# Thing IDs

Note: In WoST the ID of a Thing can be modified by the hub if the TD is received from an intermediary to reflect the domain of the Thing. Typically the 'zone' portion of the ID is modified to reflect the originating zone. 

For example, a thing with ID "URN:local:publisherID:thingID" is made available by a Hub with domain 'home1' to an intermediary with domain 'bob.com'. On the Hub bob.com this Thing is shown with ID "URN:home1:publisher1:thing1".

This will avoid naming collision on bob.com by other hubs that have Things with the same ID. Similarly any references to the original hub are replaced with bob.com's address.



## Vocabulary Of TD Property Types 

Thing properties can be used to describe sensors, actuators, internal attributes, internal state, and internal configuration. Unfortunately the WoT TD specification does not include a vocabulary of  Thing property names and types. 

Therefore, WoST defines its own property vocabulary, using the prefix "wost:". Where an existing and commonly used vocabulary exists it will be prefered. 

The '@type' attribute is used to identify the type of property (different from the data type), as suggested by @sebastiankb in this discussion: https://github.com/w3c/wot-thing-description/issues/1079. Property types are defined in hubapi api/vocabulary.go, eg: "sensor", "actuator", "configuration", "state", "attr", "input", "output" where configuration is the only writable attribute, state reflects the internal device state and can change in runtime, and attr is an static descriptive attribute such as vendor, version, and such.

Property names are part of the IoT schema. Without a recommended or commonly accepted schema, WoST uses vocabulary from existing schema definitions such as schema.org and iotschema.org.
